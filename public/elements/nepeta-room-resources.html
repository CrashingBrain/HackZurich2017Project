<link rel="import" href="/polymer/polymer.html">
<link rel="import" href="/css/shared-style.html">


<!-- Polymer components -->
<link rel="import" href="/google-map/google-map.html"></link>
<!-- Custom scripts -->

<script src="../js/ajax.js"></script>

<dom-module id="nepeta-room-resources">
  <template>
    <style is="custom-style" include="shared-style">
      :host {
        display: block;
        flex: 1;
        padding-bottom: 5%;
        background-color: green;
      }

      .news-context-wrapper {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: flex-start;
        margin: 2% 2% 0 2%;
      }

      tag-tag {
        padding: 5px;
        margin: 2px;
        color: white;
        background-color: black;
      }

      .news-article {
        margin: 2% 2% 0 2%;
        padding: 10px;
        border-radius: 2px;
        background-color: red;
        color: white;
      }

      google-map {
        height: 300px;
        width: 400px;
      }
    </style>

    <div class="news-context-wrapper">
      <span> Here Goes Map
          <google-map latitude="46.0030832" longitude="8.9485344"></google-map>
      </span>
      <span>
        Here goes people
        <template is="dom-repeat" items="{{people}}" as="person">
          <tag-tag>#{{person}}</tag-tag>
        </template>
      </span>
    </div>

  </template>

  <script>
    Polymer({
      is : 'nepeta-room-resources',

      properties: {
        MainStory: {
          type: String // this being the id of the main story
        },
        location: {
          type: String
        },
        people: {
          type: Array,
          value: [],
          reflectToAttribute: true,
        }
      },

      attached: function() {
        console.log("mainstory " + this.MainStory);
        console.log("location: " + this.location);
        this.getPeople();
      },

      getPeople: function(){
        ajaxRequest('GET', '/' + this.MainStory + '/people', null, null, (err, people)=>{
          if (err){
            console.log('something something something');
          } else if (people){
            for (let person of people){
              (person) => {
                let url = "https://en.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=&titles=" + person + "&redirects=1";
                ajaxRequest('GET', url, null, null, function(err, extract){
                  if (err){
                    console.log('impossible to get person infos.');
                  } else {
                    // let text = extract.query.pages;
                    for (var key in extract.query.pages) {
                      if (extract.query.pages.hasOwnProperty(key)) {
                        console.log(key); 
                        console.log(object[key]); 
                      }
                    }
                    // let personextract = {"name": person, "extract": text};
                    // this.push('people', personextract);
                  }
                });
              }
            }
          }
        });
      }

    });
  </script>
</dom-module>
